<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Revenue Aditya | Home</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* All your CSS styles remain the same */
        :root { --bg-primary: #101010; --bg-secondary: #1C1C1E; --text-primary: #EAEAEA; --text-secondary: #A0A0A0; --accent-primary: #0A84FF; --accent-secondary: #30D158; --accent-error: #FF453A; --border-radius: 16px; }
        body { margin: 0; font-family: sans-serif; background-color: var(--bg-primary); color: var(--text-secondary); }
        .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 30px; padding: 30px 20px; max-width: 1200px; margin: 0 auto; }
        .card { background: rgba(28, 28, 30, 0.6); padding: 30px; border-radius: var(--border-radius); border: 1px solid #2C2C2E; display: flex; flex-direction: column; width: 320px; }
        .btn { background: var(--accent-primary); color: #fff; padding: 14px 24px; border-radius: 10px; font-weight: 600; cursor: pointer; text-decoration: none; text-align: center; display: block; margin-top: 20px; }
        .overlay { position: fixed; top: 0; left: 0; height: 100%; width: 100%; background: rgba(10, 10, 10, 0.7); backdrop-filter: blur(8px); z-index: 9999; display: none; }
        .wallet-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-secondary); border-radius: 24px; width: 90%; max-width: 420px; z-index: 10000; display: none; }
        .wallet-modal-content { padding: 30px; }
        .wallet-header { display: flex; align-items: center; gap: 15px; padding-bottom: 25px; border-bottom: 1px solid #2C2C2E; }
        .wallet-header .user-info h3 { margin: 0; font-size: 20px; color:var(--text-primary); }
        .wallet-balance { text-align: center; padding: 30px 0; }
        .wallet-balance .coins { font-size: 48px; font-weight: 700; color: var(--text-primary); }
        .history-list { list-style: none; padding: 0; margin: 0; }
        .history-item { display: flex; justify-content: space-between; padding: 15px 5px; border-bottom: 1px solid #2C2C2E; }
        .history-item .amount.credit { color: var(--accent-secondary); }
        .history-item .amount.debit { color: var(--accent-error); }
        .history-empty { text-align: center; padding: 40px 0; }
    </style>
</head>
<body>
    <!-- Header, Cards, and other HTML elements -->
    <div class="container">
        <div class="card">
            <h2><i class="fa-solid fa-wallet" style="margin-right: 12px; color: var(--accent-primary);"></i>Wallet</h2>
            <p>Manage your earnings and view history.</p>
            <a class="btn" href="javascript:void(0)" onclick="showWalletModal()">Open Wallet</a>
        </div>
         <div class="card">
            <h2><i class="fa-solid fa-right-from-bracket" style="margin-right: 12px; color: var(--accent-error);"></i>Logout</h2>
            <p>Click here to sign out from your account.</p>
            <a class="btn" href="javascript:void(0)" onclick="signOutUser()">Logout</a>
        </div>
    </div>
    
    <div class="overlay" id="overlay" onclick="hideWalletModal()"></div>

    <div id="walletModal" class="wallet-modal">
        <div class="wallet-modal-content">
            <div class="wallet-header">
                <div class="user-info">
                    <h3 id="wallet-username">Loading...</h3>
                    <p id="wallet-email">...</p>
                </div>
            </div>
            <div class="wallet-balance">
                <p>Your Current Balance</p>
                <div class="coins" id="wallet-balance">...</div>
            </div>
            <h4>Transactions</h4>
            <ul id="wallet-transactions" class="history-list"></ul>
        </div>
    </div>

<script>
    // --- 1. SUPABASE CONNECTION ---
    const SUPABASE_URL = 'https://jwbbbagarnqjvlvgkreg.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp3YmJiYWdhcm5xanZsdmdrcmVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0NTE1MzEsImV4cCI6MjA3MjAyNzUzMX0.ioRBwk2r08zDg8q5LzAakMFpPYdEHnOKSGJQkZSeb30';
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // --- 2. ROUTE PROTECTION ---
    (async () => {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) {
            // अगर यूजर लॉग-इन नहीं है, तो उसे लॉगिन पेज पर भेज दो
            window.location.href = 'login.html'; // **यहाँ अपने लॉगिन पेज का सही नाम डालें**
        }
    })();
    
    // --- 3. FUNCTIONS ---
    const overlay = document.getElementById("overlay");
    const walletModal = document.getElementById("walletModal");

    async function showWalletModal() {
        overlay.style.display = "block";
        walletModal.style.display = "block";

        const { data: { user } } = await supabase.auth.getUser();
        if (user) {
            const { data: profile } = await supabase.from('profiles').select('username, balance, email').eq('id', user.id).single();
            const { data: transactions } = await supabase.from('transactions').select('*').eq('user_id', user.id).order('created_at', { ascending: false });

            document.getElementById('wallet-username').textContent = profile.username || 'New User';
            document.getElementById('wallet-email').textContent = profile.email;
            document.getElementById('wallet-balance').textContent = profile.balance.toLocaleString();

            const transactionList = document.getElementById('wallet-transactions');
            transactionList.innerHTML = '';
            if (transactions && transactions.length > 0) {
                transactions.forEach(tx => {
                    const item = document.createElement('li');
                    item.className = 'history-item';
                    item.innerHTML = `<div>${tx.description}</div> <div class="amount ${tx.type}">${tx.type === 'credit' ? '+' : '-'}${tx.amount}</div>`;
                    transactionList.appendChild(item);
                });
            } else {
                transactionList.innerHTML = '<li class="history-empty">No transactions yet.</li>';
            }
        }
    }
    
    function hideWalletModal() {
        overlay.style.display = "none";
        walletModal.style.display = "none";
    }

    async function signOutUser() {
        await supabase.auth.signOut();
        window.location.href = 'login.html'; // **यहाँ भी अपने लॉगिन पेज का सही नाम डालें**
    }
</script>
</body>
</html>
